---
layout: post
title: JavaScript Rating control to use outside list views
date: '2015-04-05T13:06:00.000-07:00'
author: Alex Terentiev
tags:
- SharePoint Online
- SharePoint UI
- Rating
- SharePoint 2010
- Reputation
- SharePoint
- JavaScript
- SharePoint 2013
- executeQueryAsync
- Client Side Object Model
- CSOM
- ReputationModel
modified_time: '2015-04-05T13:12:15.913-07:00'
blogger_id: tag:blogger.com,1999:blog-3066084330774405472.post-3408836718497044240
blogger_orig_url: http://blog.aterentiev.com/2015/04/javascript-rating-control-to-use.html
---

There are a lot of tasks when you have to display information from list item in web part or on the page without list view.<br />For example, you have to create a web part to display any kind of media on the page. And this media contains a Rating field.<br />For such situations I've created a JavaScript control to render Rating Field outside list views. The control is based on&nbsp;<a href="https://rateit.codeplex.com/" target="_blank">RateIt</a>&nbsp;jQuery plugin.<br />So no more words, let's have some code.<br /><br /><a name='more'></a>I'm assuming that jQuery has been already loaded to the page.<br /><pre class="brush: javascript;">(function () {<br />    if (!window.YourNamespace)<br />        window.YourNamespace = {};<br />    var ns = window.YourNamespace;<br />    <br />    //<br />    // I want to be sure that scripts are loaded<br />    //<br />    SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function () { });<br />    SP.SOD.executeOrDelayUntilScriptLoaded(function () { }, 'sp.js');<br /><br />    SP.SOD.executeFunc('reputation.js', 'Microsoft.Office.Server.ReputationModel.Reputation', function () { });<br />    SP.SOD.executeOrDelayUntilScriptLoaded(function () { }, 'reputation.js');<br /><br />    ns.RatingControl = function (settings) {<br />        if (!settings)<br />            return;<br />        var control = {<br />            parent: settings.parent, // parent DOM node (it could be just any css selector<br />            listId: settings.listId, // list ID<br />            itemId: settings.itemId, // item ID<br />            spContext: null,<br />            spWeb: null,<br />            spList: null,<br />            averageRating: null,<br />            ratingCount: null,<br />            _loadCss: function (src) {<br />                var css = document.createElement("link");<br />                css.setAttribute("rel", "stylesheet");<br />                css.setAttribute("type", "text/css");<br />                css.setAttribute("href", src);<br /><br />                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(css);<br />            },<br /><br />            init: function () {<br />                var path = _spPageContextInfo.siteServerRelativeUrl + 'path_to_your_scripts';<br />                this._loadCss(path + 'rateit.css'); // load standard css for RateIt control<br />                this._loadCss(path + 'your-rating-control.css'); // load customizations<br />                jQuery.when(<br />                    jQuery.getScript(path + 'jquery.rateit.min.js'), // load RateIt<br />                    this.loadRatingInfo(), // load <br />                    jQuery.Deferred(function (deferred) { deferred.resolve(); })<br />                ).done(jQuery.proxy(this.render, this));<br />            },<br /><br />            loadRatingInfo: function () {<br />                var deferred = new jQuery.Deferred();<br /><br />                if (!this.spContext) {<br />                    this.spContext = SP.ClientContext.get_current(); // getting Client Context<br />                    this.spWeb = this.spContext.get_web(); // getting Web<br />                    this.spList = this.spWeb.get_lists().getById(this.listId); // getting List<br />                }<br /><br />                var item = this.spList.getItemById(this.itemId); // getting Item<br />                this.spContext.load(this.spWeb);<br />                this.spContext.load(this.spList);<br />                this.spContext.load(item); // here we can add the second parameter like 'Include(AverageRating, RatingCount)' <br />                                           // to load only needed fields<br />                this.spContext.executeQueryAsync(jQuery.proxy(function () {<br />                    this.averageRating = item.get_item('AverageRating') || 0;<br />                    this.ratingCount = item.get_item('RatingCount') || 0;<br />                    deferred.resolve();<br />                }, this), function () {<br />                    deferred.resolve();<br />                });<br /><br />                return deferred;<br />            },<br /><br />            render: function () {<br />                var $parent = jQuery(this.parent),<br />                    $container = this.$container = jQuery('<div class="your-rating-control"></div>'); // initializing container<br /><br />                $parent.append($container);<br />                // initializing RateIt control<br />                $container.rateit({<br />                    min: 0,  // minimum 0 stars<br />                    max: 5,  // maximum 5 stars<br />                    step: 1, // step is 1 star<br />                    resetable: false, // we  don't need reset button<br />                    value: this.averageRating, // current value<br />                    starwidth: 16, // width of the star image<br />                    starheight: 16 // height of the star image<br />                }).bind('rated', jQuery.proxy(this.onRated, this)); // bind to event<br />            },<br /><br />            onRated: function (e, value) {<br />                // setting rating of the current user and gettng average one<br />                var rating = Microsoft.Office.Server.ReputationModel.Reputation.setRating(this.spContext,<br />                    this.listId, this.itemId, value);<br /><br />                this.spContext.executeQueryAsync(jQuery.proxy(function () {<br />                    this.$container.rateit('value', rating.m_value); // setting average rating value to control<br />                }, this), function () {<br />                });<br />            }<br />        };<br /><br />        return control;<br />    };<br />})();<br /></pre><br />To modify the stars images override three css classes:<br /><pre class="brush:css;">div.rateit-range<br />{<br />    background: url('empty-star.png');<br />}<br /><br />div.rateit-hover<br />{<br />    background: url('filled-star.png');<br />}<br /><br />div.rateit-selected<br />{<br />    background: url('filled-star.png');<br />}<br /></pre><br />Now you can use it:<br /><pre class="brush: javascript;">var control = new YourNamespace.RatingControl({<br />    parent: '#some-div',<br />    listId: 'guid-string',<br />    itemId: 'intId'<br />});<br />control.init();<br /></pre><br />Have fun!