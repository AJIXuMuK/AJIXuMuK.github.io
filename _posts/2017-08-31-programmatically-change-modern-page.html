---
layout: post
title: Programmatically Change Modern Page Banner Image
date: '2017-08-31T18:00:00.001-07:00'
author: Alex Terentiev
tags:
- JavaScript
- SharePoint Online
- JSOM
- Modern Page
- O365
- CSOM
- SharePoint Framework
- Office 365
- Future of SharePoint
- SharePoint
modified_time: '2017-08-31T18:00:56.469-07:00'
blogger_id: tag:blogger.com,1999:blog-3066084330774405472.post-8683812211852752162
blogger_orig_url: http://blog.aterentiev.com/2017/08/programmatically-change-modern-page.html
---

<style>.code { font-family: "courier new", "courier", monospace; font-size: 12px; } </style>In this post I want to describe how to programmatically change Modern Page Banner Image<br />The code below is written on JavaScript using JSOM (JavaScript Client Object Model) but it can be easily converted to C# (CSOM) and PowerShell as well.<br /><a name='more'></a>Let's say you've created some site using any provisioning mechanism (for example, PnP Provisioning Engine). And you also created multiple modern pages on the site and want to change the banner image for all of them.<br />After some investigation I found a way to achieve that: list items in Site Pages library have a field named <span class="code">LayoutWebpartsContent</span>. If you look at the value of this field you'll see something like: <br /><pre class="brush: html;">&lt;div&gt;<br />  &lt;div data-sp-controldata="%7B%22id%22&amp;#58;%22cbe7b0a9-3504-44dd-a3a3-0e5cacd07788%22,%22instanceId%22&amp;#58;%22cbe7b0a9-3504-44dd-a3a3-0e5cacd07788%22,%22title%22&amp;#58;%22Title%20Region%22,%22description%22&amp;#58;%22Title%20Region%20Description%22,%22serverProcessedContent%22&amp;#58;%7B%22htmlStrings%22&amp;#58;%7B%7D,%22searchablePlainTexts%22&amp;#58;%7B%7D,%22imageSources%22&amp;#58;%7B7D,%22links%22&amp;#58;%7B%7D%7D,%22dataVersion%22&amp;#58;%221.0%22,%22properties%22&amp;#58;%7B%22title%22&amp;#58;%22Logo%20test%22,%22imageSourceType%22&amp;#58;4,%22translateX%22&amp;#58;50,%22translateY%22&amp;#58;50%7D%7D" data-sp-canvascontrol=""&gt;&lt;/div&gt;<br />&lt;/div&gt;<br /></pre>So it's an HTML markup that contains interesting attribute <span class="code">data-sp-controldata</span>. It looks like some escaped JSON.<br />Let's unescape it and also replace <span class="code">&amp;#58;</span> with <span class="code">:</span>. The result looks like that: <br /><pre class="brush: javascript;">{<br />    "id": "cbe7b0a9-3504-44dd-a3a3-0e5cacd07788",<br />    "instanceId": "cbe7b0a9-3504-44dd-a3a3-0e5cacd07788",<br />    "title": "Title Region",<br />    "description": "Title Region Description",<br />    "serverProcessedContent": {<br />        "htmlStrings": {},<br />        "searchablePlainTexts": {},<br />        "imageSources": {},<br />        "links": {}<br />    },<br />    "dataVersion": "1.0",<br />    "properties": {<br />        "title": "Logo test",<br />        "imageSourceType": 4,<br />        "translateX": 50,<br />        "translateY": 50<br />    }<br />}<br /></pre>If you proceed the same steps for the page that contains some banner image, you'll see a bit different result: <br /><pre class="brush: javascript;">{<br />    "id": "cbe7b0a9-3504-44dd-a3a3-0e5cacd07788",<br />    "instanceId": "cbe7b0a9-3504-44dd-a3a3-0e5cacd07788",<br />    "title": "Title Region",<br />    "description": "Title Region Description",<br />    "serverProcessedContent": {<br />        "htmlStrings": {},<br />        "searchablePlainTexts": {},<br />        "imageSources": {<br />            "imageSource": "/sites/contoso/SiteAssets/SitePages/banner.png"<br />        },<br />        "links": {}<br />    },<br />    "dataVersion": "1.0",<br />    "properties": {<br />        "title": "Logo test",<br />        "imageSourceType": 2,<br />        "translateX": 50,<br />        "translateY": 50<br />    }<br />}<br /></pre>The differences here are in <span class="code">imageSource</span> and <span class="code">imageSourceType</span> properties (Actually you can also see different values for <span class="code">tranlateX</span> and <span class="code">translateY</span> if you changed focal point in the UI): <span class="code">imageSource</span> contains server relative URL of the image that is used as a banner and <span class="code">imageSourceType</span> contains 2 instead of 4.<br />This information is enough to add (or replace) your own banner image on any page.<br />First, you need to add the picture to some location on your tenant - SharePoint or OneDrive.<br />Second, change <span class="code">imageSource</span> and <span class="code">imageSourceType</span> properties as shown below: <br /><pre class="brush: javascript;">var ctx = SP.ClientContext.get_current(); // SP context<br />var web = ctx.get_web(); // current web<br />var list = web.get_lists().getByTitle('Site Pages'); // pages library<br />var items = list.getItems(SP.CamlQuery.createAllItemsQuery()); // all items<br />ctx.load(items); // loading items from server...<br />ctx.executeQueryAsync(function() {<br />    var item = items.get_item(0); // here I'm working with single item by index. But you can iterate through all pages here<br />    var layoutWebpartsContent = item.get_item('LayoutWebpartsContent'); // getting content<br />    console.log(layoutWebpartsContent); // let's display the content<br />    <br />    var dataAttrContent = /data-sp-controldata="([^"]+)"/gmi.exec(layoutWebpartsContent); // getting data-sp-controldata content<br />    <br />    if (dataAttrContent.length) { <br />        // we found the attribute.<br />        // Let's unescape and parse it to JSON<br />        // the content of the attribute is a 'group' in RegExp result. It will be located as second entry (with index 1)<br />        var unescaped = unescape(dataAttrContent[1]) // unescape<br />        var content = JSON.parse(unescaped.replace(/&amp;#58;/gmi, ':')); // replace &amp;#58; with :<br /><br />        //<br />        // changing imageSource<br />        //<br />        if (!content.serverProcessedContent) {<br />            content.serverProcessedContent = {};<br />        }<br />        if (!content.serverProcessedContent.imageSources) {<br />            content.serverProcessedContent.imageSources = {};<br />        }<br />        content.serverProcessedContent.imageSources.imageSource = '/sites/contoso/SiteAssets/SitePages/banner.png';<br /><br />        //<br />        // Changing imageSourceType<br />        //<br />        if (!content.properties) {<br />            content.properties = {};<br />        }<br />        content.properties.imageSourceType = 2;<br /><br />        //<br />        // escaping back and updating item<br />        //<br />        debugger;<br />        var newContent = JSON.stringify(content);<br />        newContent = escape(newContent); // escaping<br />        newContent = newContent.replace(/%3A/gmi, ':').replace(/%2C/gmi, ','); // we need to replace %3A (:) with &amp;#58; and %2C (,) with ,<br />        layoutWebpartsContent = layoutWebpartsContent.replace(dataAttrContent[1], newContent);<br />        item.set_item('LayoutWebpartsContent', layoutWebpartsContent);<br />        item.update();<br />        ctx.executeQueryAsync(function() {<br />            console.log('success');<br />        }, function() {<br />            console.log('fail');<br />        });<br />    }<br />});<br /></pre>That's it.<br />Now your page should have the banner you wanted.<br />Have fun!