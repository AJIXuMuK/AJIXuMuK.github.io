---
layout: post
title: Using PnP Field Controls in PnP ListView to Render Taxonomy, Pictures and Other
  Types of SharePoint Columns
date: '2020-03-10T08:20:00.002-07:00'
author: Alex Terentiev
tags:
- SharePoint Online
- Field Controls
- Microsoft 365
- SharePoint Framework
- Office 365
- SharePoint Development
- ListView
- PnP
- SharePoint
- PnP Reusable Controls
- SPFx
- Office Development
- SPFx Web Parts
modified_time: '2020-03-10T08:20:57.165-07:00'
thumbnail: https://4.bp.blogspot.com/-oVXtgOckIaE/XmcDbe4kVZI/AAAAAAAABiA/nDIr-ArZvJ8tqpfcZaeCb2I6jdg6w4koQCLcBGAsYHQ/s72-c/list-items.png
blogger_id: tag:blogger.com,1999:blog-3066084330774405472.post-1077381746766294427
blogger_orig_url: http://blog.aterentiev.com/2020/03/using-pnp-field-controls-in-pnp.html
---

<style>.code { font-family: Consolas, "courier new", "courier", monospace; font-size: 13px; } </style>This blog post is based on <a href="https://github.com/SharePoint/sp-dev-fx-webparts/tree/dev/samples/react-pnp-controls-list-view-fields" target="_blank">SPFx web part sample</a> that shows how to use <a href="https://sharepoint.github.io/sp-dev-fx-controls-react/controls/fields/main/" target="_blank">PnP Field Controls</a> to render different types of SharePoint columns in <a href="https://sharepoint.github.io/sp-dev-fx-controls-react/controls/ListView/" target="_blank">ListView</a> control.<br /><a name='more'></a><h2>Objective</h2>Let's say we have a SharePoint list with such columns as Lookup, Choice, Hyperlink or Picture, etc. And we want to display items from this list in our SPFx web part.<br />In this blog post I will use the list as shown below:<br /><a href="https://4.bp.blogspot.com/-oVXtgOckIaE/XmcDbe4kVZI/AAAAAAAABiA/nDIr-ArZvJ8tqpfcZaeCb2I6jdg6w4koQCLcBGAsYHQ/s1600/list-items.png" imageanchor="1"><img border="0" data-original-height="397" data-original-width="1600" src="https://4.bp.blogspot.com/-oVXtgOckIaE/XmcDbe4kVZI/AAAAAAAABiA/nDIr-ArZvJ8tqpfcZaeCb2I6jdg6w4koQCLcBGAsYHQ/s1600/list-items.png" width="600" /></a><a href="https://2.bp.blogspot.com/-lLjLhaSCGXU/XmcDepAnbbI/AAAAAAAABiE/_nDgUF3ZieA83wsn_AztXKGygxnQfFpBgCLcBGAsYHQ/s1600/list-cols.png" imageanchor="1"><img border="0" data-original-height="698" data-original-width="1548" src="https://2.bp.blogspot.com/-lLjLhaSCGXU/XmcDepAnbbI/AAAAAAAABiE/_nDgUF3ZieA83wsn_AztXKGygxnQfFpBgCLcBGAsYHQ/s1600/list-cols.png" width="600" /></a><br />We want to display this list in our web part similarly to the OOTB rendering.<br /><h2>Getting the Items</h2>First thing to do - we need to request the list items from SharePoint.<br />There are several way how you can do that: <br /><ul><li>Using SharePoint REST API</li><li>Using Microsoft Graph</li><li>Using PnPJS library</li></ul>I will use PnPJS. And to be more precise: <span class="code">getItemsByCAMLQuery</span> method of <span class="code">IList</span> object. This method allows to correctly get labels for Managed Metadata columns (selected terms). And this is required for the selected list. So, let's install PnPJS module to our project: <br /><pre class="brush: bash;">npm i --save @pnp/sp<br /></pre>Now let's import all needed instances in our web part's <span class="code">ts</span> file: <br /><pre class="brush: typescript;">import { sp } from '@pnp/sp';<br />import '@pnp/sp/webs';<br />import '@pnp/sp/lists';<br />import '@pnp/sp/items';<br /></pre>And let's request the items in web part's <span class="code">onInit</span> method: <br /><pre class="brush: typescript;">private _items: any[];<br />protected async onInit(): Promise&lt;void&gt; {<br />  await super.onInit();<br /><br />  sp.setup({<br />    spfxContext: this.context<br />  });<br /><br />  const countries = await sp.web.lists.getByTitle('Country').items.get(); // getting Country items to get lookup values<br /><br />  this._items = await sp.web.lists.getByTitle('Journeys').getItemsByCAMLQuery({<br />    ViewXml: ''<br />  });<br /><br />  // getting lookup values by ids<br />  this._items.forEach(item =&gt; {<br />    const visitedCountriesIds: number[] = item['VisitedCountriesId'] as number[];<br />    item['VisitedCountries'] = countries.filter(c =&gt; visitedCountriesIds.indexOf(c['ID']) !== -1).map(c =&gt; c['Title']);<br />  });<br /><br />}<br /></pre>This request will return items in the format shown below:<br /><pre class="brush: javascript;">[<br />  {<br />    "Title": "Teen Vacation",<br />    "JourneyDate": "2000-07-10T00:00:00",<br />    "VisitedCountriesId": [<br />      5<br />    ],<br />    "Experience": "Good",<br />    "Picture": {<br />      "Description": "Hungray",<br />      "Url": "https://www.coe.int/documents/14577325/16404142/HUN_publication_report/6bac7580-94d7-1cf7-ba59-d3c74228fbad?t=1569512959000"<br />    },<br />    "JourneyType": {<br />      "Label": "Leisure",<br />      "TermGuid": "2262759a-0902-4ec6-87e0-910abb935f59",<br />      "WssId": 1<br />    },<br />    "VisitedCountries": [<br />      "Hungary"<br />    ]<br />  },<br />  {<br />    "Title": "Europe Journey",<br />    "JourneyDate": "2013-12-05T00:00:00",<br />    "VisitedCountriesId": [<br />      6,<br />      3<br />    ],<br />    "Experience": "Good",<br />    "Picture": {<br />      "Description": "greece",<br />      "Url": "https://static.coindesk.com/wp-content/uploads/2018/10/greece-1594689_1920-710x458.jpg?format=webp"<br />    },<br />    "JourneyType": {<br />      "Label": "Leisure",<br />      "TermGuid": "2262759a-0902-4ec6-87e0-910abb935f59",<br />      "WssId": 1<br />    },<br />    "VisitedCountries": [<br />      "Greece",<br />      "France"<br />    ]<br />  }<br />]<br /></pre>As you can see, such columns as <span class="code">VisitedCountriesId</span>, Picture and others are complex object with multiple properties. And we are additionally processing <span class="code">VisitedCountriesIds</span> to add <span class="code">VisitedCountries</span> property to contain array of lookup values. <br /><h2>PnP ListView</h2>PnP <span class="code">ListView</span> component allows you to render collection of items. It is based on Office UI Fabric React <span class="code">DetailsList</span> and allow to render items similarly to Office 365 experience.<br />You have to provide a list of view fields as <span class="code">IViewField[]</span> that describes what columns to render and list of items as <span class="code">any[]</span>. You can read documentation on these parameters <a href="https://sharepoint.github.io/sp-dev-fx-controls-react/controls/ListView/" target="_blank">here</a>.<br />The problem with this controls is that it flattens the passed items. And for our example, for <span class="code">VisitedCountries</span> it will create a separate property for each array member: <br /><pre class="brush: javascript;">{<br />  "VisitedCountries.0": "Greece",<br />  "VisitedCountries.1": "France"<br />}<br /></pre>Such a format doesn't allow to correctly specify <span class="code">IViewField</span> instance to render array.<br />Good thing is - we can define render function for each column and provide custom rendering for a cell there. <br /><h2>Field Controls</h2><a href="https://sharepoint.github.io/sp-dev-fx-controls-react/controls/fields/main/" target="_blank">PnP Field Controls</a> were initially created to be used in SPFx Field Customizers to provide rendering of the fields similar to out of the box experience.<br />But technically we can use them in web parts as well. And, as a result, we can use them to provide custom rendering for <span class="code">ListView</span> cells. <br /><h2>Combining Everything</h2>So, let's use Field Controls in our <span class="code">ListView</span>.<br />And first thing - add all needed imports: <br /><pre class="brush: typescript;">import { ListView, IViewField } from '@pnp/spfx-controls-react/lib/ListView';<br />import { FieldTextRenderer } from '@pnp/spfx-controls-react/lib/FieldTextRenderer';<br />import { FieldDateRenderer } from '@pnp/spfx-controls-react/lib/FieldDateRenderer';<br />import { FieldLookupRenderer } from '@pnp/spfx-controls-react/lib/FieldLookupRenderer';<br />import { FieldUrlRenderer } from '@pnp/spfx-controls-react/lib/FieldUrlRenderer';<br />import { FieldTaxonomyRenderer } from '@pnp/spfx-controls-react/lib/FieldTaxonomyRenderer';<br />import { ISPFieldLookupValue } from '@pnp/spfx-controls-react/lib/Common';<br /></pre>For Title and Experience (Choice) we will use simple <span class="code">FieldTextRenderer</span>: <br /><pre class="brush: typescript;">private _renderTitle(item?: any): any {<br />  return &lt;FieldTextRenderer<br />    text={item.Title}<br />  /&gt;;<br />}<br /><br />private _renderExperience(item?: any): any {<br />  const experience = item['Expirience'];<br /><br />  return &lt;FieldTextRenderer<br />    text={experience}<br />  /&gt;;<br />}<br /></pre>For date - <span class="code">FieldDateRenderer</span>: <br /><pre class="brush: typescript;">private _renderDate(item?: any): any {<br />  const date = new Date(item['JourneyDate']);<br />  return &lt;FieldDateRenderer<br />    text={date.toLocaleDateString()} /&gt;;<br />}<br /></pre>For the Picture (Hyperlink or Picture) we need to get 2 properties of the flattened item: <span class="code">Picture.Url</span> and <span class="code">Picture.Description</span> to use <span class="code">FieldUrlRenderer</span><br /><pre class="brush: typescript;">private _renderPicture(item?: any): any {<br /><br />  return &lt;FieldUrlRenderer<br />    url={item['Picture.Url']}<br />    isImageUrl={true}<br />    className={styles.image}<br />    text={item['Picture.Description'] || ''} /&gt;;<br />}<br /></pre>Similarly, for JorneyType (Managed Metadata) we need <span class="" code="">JourneyType.Label</span> and <span class="code">JourneyType.TermGuid</span> to use <span class="code">FieldTaxonomyRenderer</span>: <br /><pre class="brush: typescript;">private _renderJourneyType(item?: any) {<br /><br />  return &lt;FieldTaxonomyRenderer<br />    terms={[{<br />      Label: item['JourneyType.Label'],<br />      TermID: item['JourneyType.TermGuid']<br />    }]} /&gt;;<br />  }<br /></pre>The most interesting part is VisitedCoutries. As this is a lookup column we want to displayed referenced item when user clicks on the lookup value. We can display this item either in a separate tab or in a popup. I will show the second option. So, first let's use <span class="code">FieldLookupRenderer</span> to render the values and handle <span class="code">onClick</span>: <br /><pre class="brush: typescript;">private _renderCountries(item?: any, index?: number): any {<br />  //<br />  // ListView item contains "flattened" information<br />  // So, we're getting original item first<br />  //<br /><br />  const originalItem = this.props.items[index!];<br />  const visitedCountriesIds = originalItem['VisitedCountriesId'];<br />  const visitedCountries = originalItem['VisitedCountries'];<br /><br />  const lookups: ISPFieldLookupValue[] = visitedCountries.map((vc, idx) =&gt; {<br />    return {<br />      lookupId: visitedCountriesIds[idx].toString(),<br />      lookupValue: vc<br />    };<br />  });<br /><br />    return &lt;FieldLookupRenderer<br />      lookups={lookups}<br />      onClick={args =&gt; {<br />        this.setState({<br />          selectedLookupId: args.lookup.lookupId<br />        });<br />      }} /&gt;;<br />  }<br /></pre>And if <span class="code">selectedLookupId</span> is set, we'll use one more PnP Reusable Control <span class="code">IFrameDialog</span> to render list item display form as a dialog: <br /><pre class="brush: typescript;">import { IFrameDialog } from '@pnp/spfx-controls-react/lib/IFrameDialog';<br />import { DialogType } from 'office-ui-fabric-react/lib/Dialog';<br />//...<br />public render(): React.ReactElement&lt;IPnPListViewProps&gt; {<br />//...<br />{this.state.selectedLookupId &amp;&amp;<br />  &lt;IFrameDialog<br />    hidden={false}<br />    url={`${this.props.context.pageContext.web.absoluteUrl}${this._lookupFieldDispWebRelativeUrl.replace('{0}', this.state.selectedLookupId.toString())}`}<br />    iframeOnLoad={iframe =&gt; {<br />      const iframeWindow: Window = iframe.contentWindow;<br />      const iframeDocument: Document = iframeWindow.document;<br /><br />      const s4Workspace: HTMLDivElement = iframeDocument.getElementById('s4-workspace') as HTMLDivElement;<br />      s4Workspace.style.height = iframe.style.height;<br /><br />      s4Workspace.scrollIntoView();<br />    }}<br />    onDismiss={() =&gt; {<br />      this.setState({<br />        selectedLookupId: undefined<br />      });<br />    }}<br />    modalProps={{ "{{" }}<br />      isBlocking: true<br />    }}<br />    dialogContentProps={{ "{{" }}<br />      type: DialogType.close,<br />      showCloseButton: true<br />    }}<br />    width={'570px'}<br />    height={'250px'} /&gt;}<br />//...<br />}<br /></pre>The constructed <span class="code">url</span> parameter will look like that: <span class="code">https://tenant.sharepoint.com/sites/your-site/Lists/Journeys/DispForm.aspx?ID=item-id&amp;IsDlg=1</span><br />The final code of the component: <br /><pre class="brush: typescript;">export default class PnPListView extends React.Component&lt;IPnPListViewProps, IPnPListViewState&gt; {<br /><br />  private readonly _countriesLookupFieldId = '5e037cea-aaef-40dd-895f-90442114016f';<br />  private readonly _lookupFieldDispWebRelativeUrl = '/Lists/Country/DispForm.aspx?ID={0}&amp;RootFolder=*&amp;IsDlg=1';<br /><br />  private readonly _fields: IViewField[] = [{<br />    name: 'Title',<br />    displayName: 'Title',<br />    minWidth: 150,<br />    maxWidth: 250,<br />    render: this._renderTitle<br />  }, {<br />    name: 'JourneyDate',<br />    displayName: 'Journey Date',<br />    render: this._renderDate<br />  }, {<br />    name: 'VisitedCountries',<br />    displayName: 'Visited Countries',<br />    minWidth: 100,<br />    render: (item, index) =&gt; { return this._renderCountries(item, index); }<br />  }, {<br />    name: 'Experience',<br />    displayName: 'Experience',<br />    minWidth: 100,<br />    render: this._renderExperience<br />  }, {<br />    name: 'Picture',<br />    displayName: 'Picture',<br />    minWidth: 150,<br />    render: this._renderPicture<br />  }, {<br />    name: 'JourneyType',<br />    displayName: 'Journey Type',<br />    minWidth: 100,<br />    render: this._renderJourneyType<br />  }];<br /><br />  constructor(props: IPnPListViewProps) {<br />    super(props);<br /><br />    this.state = {};<br />  }<br /><br /><br />  public render(): React.ReactElement&lt;IPnPListViewProps&gt; {<br />    return (<br />      &lt;div className={styles.pnPListView}&gt;<br />        &lt;ListView items={this.props.items} viewFields={this._fields} /&gt;<br />        {this.state.selectedLookupId &amp;&amp;<br />          &lt;IFrameDialog<br />            hidden={false}<br />            url={`${this.props.context.pageContext.web.absoluteUrl}${this._lookupFieldDispWebRelativeUrl.replace('{0}', this.state.selectedLookupId.toString())}`}<br />            iframeOnLoad={iframe =&gt; {<br />              const iframeWindow: Window = iframe.contentWindow;<br />              const iframeDocument: Document = iframeWindow.document;<br /><br />              const s4Workspace: HTMLDivElement = iframeDocument.getElementById('s4-workspace') as HTMLDivElement;<br />              s4Workspace.style.height = iframe.style.height;<br /><br />              s4Workspace.scrollIntoView();<br />            }}<br />            onDismiss={() =&gt; {<br />              this.setState({<br />                selectedLookupId: undefined<br />              });<br />            }}<br />            modalProps={{ "{{" }}<br />              isBlocking: true<br />            }}<br />            dialogContentProps={{ "{{" }}<br />              type: DialogType.close,<br />              showCloseButton: true<br />            }}<br />            width={'570px'}<br />            height={'250px'} /&gt;}<br />      &lt;/div&gt;<br />    );<br />  }<br /><br />  /**<br />   * Title column renderer<br />   * @param item ListView item<br />   */<br />  private _renderTitle(item?: any): any {<br />    return &lt;FieldTextRenderer<br />      text={item.Title}<br />    /&gt;;<br />  }<br /><br />  /**<br />   * Date column renderer<br />   * @param item ListView item<br />   */<br />  private _renderDate(item?: any): any {<br />    const date = new Date(item['JourneyDate']);<br />    return &lt;FieldDateRenderer<br />      text={date.toLocaleDateString()} /&gt;;<br />  }<br /><br />  /**<br />   * Countries (Multi Lookup) column renderer<br />   * @param item ListView item<br />   * @param index item index<br />   */<br />  private _renderCountries(item?: any, index?: number): any {<br />    //<br />    // ListView item contains "flattened" information<br />    // So, we're getting original item first<br />    //<br /><br />    const originalItem = this.props.items[index!];<br />    const visitedCountriesIds = originalItem['VisitedCountriesId'];<br />    const visitedCountries = originalItem['VisitedCountries'];<br /><br />    const lookups: ISPFieldLookupValue[] = visitedCountries.map((vc, idx) =&gt; {<br />      return {<br />        lookupId: visitedCountriesIds[idx].toString(),<br />        lookupValue: vc<br />      };<br />    });<br /><br />    return &lt;FieldLookupRenderer<br />      lookups={lookups}<br />      onClick={args =&gt; {<br />        this.setState({<br />          selectedLookupId: args.lookup.lookupId<br />        });<br />      }} /&gt;;<br />  }<br /><br />  /**<br />   * Experience (Choice) column renderer<br />   * @param item ListView item<br />   */<br />  private _renderExperience(item?: any): any {<br />    const experience: string = item['Expirience'];<br /><br />    return &lt;FieldTextRenderer<br />      text={experience}<br />    /&gt;;<br />  }<br /><br />  /**<br />   * Picture (Hyperlink or Picture) column renderer<br />   * @param item ListView item<br />   */<br />  private _renderPicture(item?: any): any {<br /><br />    return &lt;FieldUrlRenderer<br />      url={item['Picture.Url']}<br />      isImageUrl={true}<br />      className={styles.image}<br />      text={item['Picture.Description'] || ''} /&gt;;<br />  }<br /><br />  /**<br />   * JourneyType (Managed Metadata) column renderer<br />   * @param item ListView item<br />   */<br />  private _renderJourneyType(item?: any) {<br /><br />    return &lt;FieldTaxonomyRenderer<br />      terms={[{<br />        Label: item['JourneyType.Label'],<br />        TermID: item['JourneyType.TermGuid']<br />      }]} /&gt;;<br />  }<br />}<br /></pre>And this is how our list will look:<br /><a href="https://1.bp.blogspot.com/-S9laC1T4cd4/XmcX-Z4Jb0I/AAAAAAAABik/G3RZolr0-AIbVefrIRg9R17hli9r7zBCACLcBGAsYHQ/s1600/web-part.png" imageanchor="1"><img border="0" data-original-height="550" data-original-width="1600" src="https://1.bp.blogspot.com/-S9laC1T4cd4/XmcX-Z4Jb0I/AAAAAAAABik/G3RZolr0-AIbVefrIRg9R17hli9r7zBCACLcBGAsYHQ/s1600/web-part.png" width="600" /></a><br />And lookup popup:<br /><a href="https://2.bp.blogspot.com/-As8DWrFCyRU/XmcYZNLq5JI/AAAAAAAABis/qTIf-RccuLEEbG-8KSi9WQs1SQAlMYgiACLcBGAsYHQ/s1600/popup.png" imageanchor="1"><img border="0" data-original-height="688" data-original-width="1600" src="https://2.bp.blogspot.com/-As8DWrFCyRU/XmcYZNLq5JI/AAAAAAAABis/qTIf-RccuLEEbG-8KSi9WQs1SQAlMYgiACLcBGAsYHQ/s1600/popup.png" width="600" /></a><br /><h2>Conclusion</h2>As you can see it's pretty easy to combine different PnP Reusable Controls to work together. Using the same technique you can render other SharePoint column types like People or Group, multiline text, and others.<br />As mentioned in the beginning of the post, you can find all the code <a href="https://github.com/SharePoint/sp-dev-fx-webparts/tree/dev/samples/react-pnp-controls-list-view-fields" target="_blank">here</a><br /><br /><br />That's all for today!<br />Have fun!